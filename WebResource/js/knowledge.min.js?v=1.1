var table;function table_init(){listbox_setup();table=$("#knowledgeTable").DataTable({responsive:true,"sPaginationType":$(window).width()>=992?"full_numbers":"listbox","dom":"rtip","processing":true,"serverSide":true,"bServerSide":true,"ajax":{"url":"/servlet/PublicKBCtrl","type":"POST","data":{func:"getPetitionDataList",subCateId:function(){if($("#subCategoryList")[0].value==="NO"){return $("#categoryList")[0].value}else{return $("#subCategoryList")[0].value}},searchWord:function(){return $("#search_input")[0].value}}},"initComplete":function(b,a){},"fnDrawCallback":function(a){checkCookieAndSetFont()},"columns":[{"data":"eDate"},{"data":"title"},{"data":"ownerPUnit"}],"columnDefs":[{"targets":0,orderable:true,"width":"70px"},{"targets":1,orderable:false,"render":function(c,b,a,d){if(otherChannel=="y"){return'<a class="fontText-md" href="/interface/Petition?router=knowledgeDetail&KBId='+a.KBId+' ">'+c+"</a>"}else{return'<a class="fontText-md" href="/main/PageCtrl?p=k_2&KBId='+a.KBId+' ">'+c+"</a>"}}},{"targets":2,orderable:false,"width":"100px"}],"lengthMenu":[[10],[10]],"order":[[0,"desc"]],"bPaginate":true,"bLengthChange":true,"bFilter":false,"bInfo":true,"bAutoWidth":true,"language":{"lengthMenu":"每頁 _MENU_ 筆資料","zeroRecords":"目前此類別尚無知識問答！","info":"目前位於_PAGE_/_PAGES_頁","search":"搜尋關鍵字:","infoEmpty":"","infoFiltered":"(filtered from _MAX_ total records)","paginate":{"first":"<<","last":">>","previous":"<","next":">"}}});tableDidAppear()}function tableDidAppear(){if($(window).width()<768){table.column("2").visible(false)}else{table.column("2").visible(true)}$(window).resize(function(){if($(window).width()<768){table.column("2").visible(false)}else{table.column("2").visible(true)}})}function getMainCate(){var a=$("#categoryList").val();$("#subCategoryList").find("option").remove();$("#subCategoryList").append('<option value="" disabled selected hidden>請先選擇建議主類別</option>');$.ajax({url:"/servlet/FormAjax",type:"post",data:{func:"getCategory",channel:"D",showAll:true},dataType:"json",success:function(e){$("#categoryList").find("option").remove();$("#categoryList").append('<option value="">全部建議主類別</option>');var b=document.getElementById("categoryList");for(var d=0;d<e.rows.length;d++){var c=document.createElement("option");c.value=e.rows[d].cateId;c.innerHTML=e.rows[d].cateName;b.appendChild(c)}if(cateId!=""){$("#categoryList option").each(function(f,g){if(g.value==cateId){$("#categoryList").val(g.value);categoryChanged($("#categoryList")[f])}})}else{}}})}var categoryMap={};function categoryChanged(a){$("#subCategoryList").find("option").remove();$("#subCategoryList").append('<option value="NO">請選擇建議次類別</option>');var b=$("#categoryList").val();var c="";try{c=a.options[a.selectedIndex].value}catch(d){}$.ajax({url:"/servlet/FormAjax",type:"post",data:{func:"getCategoryDetail",channel:"D",mainCateId:b,showAll:true},dataType:"json",success:function(j){if(b==""){$("#subCategoryList").find("option").remove();$("#subCategoryList").append('<option value="">請先選擇建議主類別</option>');try{reloadTable()}catch(k){}return}var f=document.getElementById("subCategoryList");categoryMap={};for(var h=0;h<j.rows.length;h++){categoryMap[j.rows[h].cateId]=j.rows[h].remark;var g=document.createElement("option");g.value=j.rows[h].cateId;g.innerHTML=j.rows[h].cateName;f.appendChild(g)}if(subCateId!=""){$("#subCategoryList option").each(function(e,i){if(i.value==subCateId){$("#subCategoryList").val(i.value)}})}try{reloadTable()}catch(k){}}})}function listbox_setup(){$.fn.dataTableExt.oPagination.listbox={"fnInit":function(g,c,e){var h=document.createElement("select");var d=document.createElement("span");var a=document.createElement("span");var f=document.createElement("span");var b=document.createElement("span");f.appendChild(document.createTextNode(g.oLanguage.oPaginate.sPrevious));b.appendChild(document.createTextNode(g.oLanguage.oPaginate.sNext));f.className="paginate_button previous";b.className="paginate_button next";a.className="paginate_of";d.className="paginate_page";if(g.sTableId!==""){c.setAttribute("id",g.sTableId+"_paginate")}h.style.display="inline";d.innerHTML=" Page";c.appendChild(f);c.appendChild(h);c.appendChild(a);c.appendChild(b);$(h).change(function(j){if(this.value===""||this.value.match(/[^0-9]/)){return}var i=g._iDisplayLength*(this.value-1);if(i>g.fnRecordsDisplay()){g._iDisplayStart=(Math.ceil((g.fnRecordsDisplay()-1)/g._iDisplayLength)-1)*g._iDisplayLength;e(g);return}g._iDisplayStart=i;e(g)});$("span",c).bind("mousedown",function(){return false});$("span",c).bind("selectstart",function(){return false});$(f).click(function(){g.oApi._fnPageChange(g,"previous");e(g)});$(b).click(function(){g.oApi._fnPageChange(g,"next");e(g)})},"fnUpdate":function(a,k){if(!a.aanFeatures.p){return}var b=Math.ceil((a.fnRecordsDisplay())/a._iDisplayLength);var o=Math.ceil(a._iDisplayStart/a._iDisplayLength)+1;var g=a.aanFeatures.p;for(var f=0,c=g.length;f<c;f++){var l=g[f].getElementsByTagName("span");var h=g[f].getElementsByTagName("select");var d=h[0];if(d.options.length!=b){d.options.length=0;for(var e=0;e<b;e++){var n=document.createElement("option");n.text=e+1;n.value=e+1;try{d.add(n,null)}catch(m){d.add(n)}}l[1].innerHTML="&nbsp;of&nbsp;"+b}d.value=o}}}};